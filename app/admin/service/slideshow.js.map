{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\service\\slideshow.js"
    ],
    "names": [
        "fs",
        "require",
        "path",
        "helper",
        "qiniu",
        "accessKey",
        "secretKey",
        "mac",
        "auth",
        "digest",
        "Mac",
        "bucket",
        "options",
        "scope",
        "putPolicy",
        "rs",
        "PutPolicy",
        "uploadToken",
        "config",
        "conf",
        "Config",
        "zone",
        "Zone_z0",
        "module",
        "exports",
        "think",
        "Service",
        "constructor",
        "putfileQiniu",
        "file",
        "name",
        "filepath",
        "newname",
        "formUploader",
        "form_up",
        "FormUploader",
        "putExtra",
        "PutExtra",
        "up",
        "deferred",
        "defer",
        "returnInfo",
        "putFile",
        "respErr",
        "respBody",
        "respInfo",
        "resolve",
        "msg",
        "data",
        "statusCode",
        "promise",
        "deleteQiniuImg",
        "filePath",
        "bucketManager",
        "BucketManager",
        "deleteFile",
        "delete",
        "err",
        "queryInfoImg",
        "getInfo",
        "stat",
        "console",
        "log"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\service\\slideshow.js",
    "sourcesContent": [
        "/**\r\n * Created by Administrator on 2018/1/23.\r\n * 上传文件到七牛云\r\n *\r\n */\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst helper = require('think-helper');\r\n\r\nconst qiniu=require('qiniu');\r\n\r\nconst accessKey = 'If1SWAP60HYq8YUtCWSvgNiL-dvIh_sjVgS3-YPc';\r\nconst secretKey = 'CBcrPNhdn17uTo5fKT3lx-bBgqRI5TFeDs-dizET';\r\nconst mac = new qiniu.auth.digest.Mac(accessKey, secretKey);\r\nlet bucket='iyuge'\r\nlet options = {\r\n\tscope: bucket,  //空间名称\r\n};\r\nlet putPolicy = new qiniu.rs.PutPolicy(options);\r\nlet uploadToken=putPolicy.uploadToken(mac); //创建一个token\r\n\r\nlet config = new qiniu.conf.Config();\r\n// 空间对应的机房\r\nconfig.zone = qiniu.zone.Zone_z0; //华东\r\n// 是否使用https域名\r\n//config.useHttpsDomain = true;\r\n// 上传是否使用cdn加速\r\n//config.useCdnDomain = true;\r\nmodule.exports = class extends think.Service {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t/*\r\n\t* 上传图片到七牛\r\n\t* */\r\n\tasync putfileQiniu(file,name) {\r\n\r\n\t\tlet filepath=file,\r\n\t\t\tnewname=name;\r\n\r\n\t\tconst formUploader = new qiniu.form_up.FormUploader(config);  //文件上传 表单上传\r\n\t\tconst putExtra = new qiniu.form_up.PutExtra();\r\n\t\tfunction up(uploadToken,newname,filepath,putExtra) {\r\n\t\t\tlet deferred = think.defer();\r\n\t\t\tlet returnInfo={};\r\n\t\t\tformUploader.putFile(uploadToken,newname, filepath, putExtra, function(respErr,respBody, respInfo){\r\n\t\t\t\tif (respErr) {\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'error_1',\r\n\t\t\t\t\t\t\tdata:[]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (respInfo.statusCode == 200) {  //上传文件成功 然后复制一个副本作为缩略图\r\n\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'success',\r\n\t\t\t\t\t\t\tdata:respBody\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//console.log(respInfo.statusCode);\r\n\t\t\t\t\t//console.log(respBody);\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'error_2',\r\n\t\t\t\t\t\t\tdata:respBody\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t}\r\n\r\n\t\treturn await up(uploadToken,newname,filepath,putExtra);\r\n\r\n\t}\r\n\t/*\r\n\t* 删除七牛上的图片\r\n\t* */\r\n\tasync deleteQiniuImg(file){\r\n\t\tlet filePath=file;\r\n\t\tconst bucketManager = new qiniu.rs.BucketManager(mac, config);  //资源管理\r\n\t\tlet deferred = think.defer();\r\n\t\tlet returnInfo={};\r\n\r\n\t\tfunction deleteFile(filePath) {\r\n\t\t\tbucketManager.delete(bucket, filePath, function(err, respBody, respInfo) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'error',\r\n\t\t\t\t\t\t\tdata:'删除失败'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif(respInfo.statusCode==200)\r\n\t\t\t\t{\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'success',\r\n\t\t\t\t\t\t\tdata:'删除成功'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'error',\r\n\t\t\t\t\t\t\tdata:'删除失败'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t}\r\n\t\treturn await deleteFile(filePath);\r\n\r\n\t}\r\n\t/*\r\n\t* 查询七牛上的图片文件\r\n\t* */\r\n\tasync queryInfoImg(file){\r\n\t\tlet filePath=file;\r\n\t\tconst bucketManager = new qiniu.rs.BucketManager(mac, config);  //资源管理\r\n\t\tlet deferred = think.defer();\r\n\t\tlet returnInfo={};\r\n\t\tfunction getInfo(filePath) {\r\n\t\t\tbucketManager.stat(bucket, filePath, function(err, respBody, respInfo) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'error',\r\n\t\t\t\t\t\t\tdata:'删除失败'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (respInfo.statusCode == 200) {\r\n\t\t\t\t\t/*console.log(respBody.hash);\r\n\t\t\t\t\t console.log(respBody.fsize);\r\n\t\t\t\t\t console.log(respBody.mimeType);\r\n\t\t\t\t\t console.log(respBody.putTime);\r\n\t\t\t\t\t console.log(respBody.type);*/\r\n\t\t\t\t\tconsole.log(respBody)\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'success',\r\n\t\t\t\t\t\t\tdata:respBody\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeferred.resolve(\r\n\t\t\t\t\t\treturnInfo={\r\n\t\t\t\t\t\t\tmsg:'error',\r\n\t\t\t\t\t\t\tdata:'删除失败'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\t\t\treturn deferred.promise;\r\n\t\t}\r\n\t\treturn await getInfo(filePath);\r\n\t}\r\n};"
    ]
}