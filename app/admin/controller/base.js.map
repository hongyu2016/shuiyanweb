{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\base.js"
    ],
    "names": [
        "module",
        "exports",
        "think",
        "Controller",
        "__before",
        "userinfo",
        "session",
        "isEmpty",
        "ctx",
        "controller",
        "redirect",
        "menuList",
        "model",
        "order",
        "select",
        "commonFunion",
        "commonFun",
        "newMenu",
        "formatMenu",
        "shuiyanImgThumb",
        "shuiyanImgThumb2",
        "assign",
        "myurl",
        "action",
        "role_id",
        "where",
        "admin_id",
        "getField",
        "auth_rule",
        "myAuth",
        "yunxuUrl",
        "i",
        "indexOf",
        "isAjax",
        "json",
        "success",
        "errmsg",
        "errno",
        "data",
        "display"
    ],
    "mappings": "AAAA;;;;;;;;AAA8D;AAC9DA,OAAOC,OAAP,GAAiB,cAAcC,MAAMC,UAApB,CAA+B;AACzCC,SAAN,GAAiB;AAAA;;AAAA;AAChB,OAAIC,WAAW,MAAM,MAAKC,OAAL,CAAa,UAAb,CAArB;AACA,OAAGJ,MAAMK,OAAN,CAAcF,QAAd,CAAH,EAA4B;AAC3B,QAAG,MAAKG,GAAL,CAASC,UAAT,IAAuB,OAA1B,EAAmC;AAClC,YAAO,MAAKC,QAAL,CAAc,cAAd,CAAP;AACA;AACD,IAJD,MAIM;AACL,QAAIC,WAAW,MAAM,MAAKC,KAAL,CAAW,MAAX,EAAmBC,KAAnB,CAAyB,6BAAzB,EAAwDC,MAAxD,EAArB,CADK,CACkF;AACvF,QAAIC,eAAe,IAAIC,yBAAJ,EAAnB,CAFK,CAE+B;AACpC,QAAIC,UAAUF,aAAaG,UAAb,CAAwBP,QAAxB,CAAd;AACA,UAAMQ,kBAAkB,gKAAxB,CAJK,CAIoL;AACzL,UAAMC,mBAAmB,0KAAzB;AACA,UAAKC,MAAL,CAAY;AACX;AACA,qBAAe,wBAFJ;AAGX,wBAAmBF,eAHR,EAGyB;AACpC,yBAAmBC,gBAJR,EAI0B;AACrC,gBAAWH,OALA,EAKS;AACpB,iBAAYZ,QAND,CAMS;AANT,KAAZ;AAQA;;AAED;AACA,OAAIiB,QAAM,MAAKd,GAAL,CAASR,MAAT,GAAgB,GAAhB,GAAoB,MAAKQ,GAAL,CAASC,UAA7B,GAAwC,GAAxC,GAA4C,MAAKD,GAAL,CAASe,MAA/D,CAvBgB,CAuBwD;AACxE,OAAIC,UAAQ,MAAM,MAAKZ,KAAL,CAAW,OAAX,EAAoBa,KAApB,CAA0B,EAAC,YAAWpB,SAASqB,QAArB,EAA1B,EAA0DC,QAA1D,CAAmE,SAAnE,CAAlB;AACA,OAAIC,YAAU,MAAM,MAAKhB,KAAL,CAAW,MAAX,EAAmBa,KAAnB,CAAyB,EAAC,WAAUD,QAAQ,CAAR,CAAX,EAAzB,EAAiDG,QAAjD,CAA0D,WAA1D,CAApB;AACA,OAAIE,SAAO,MAAM,MAAKjB,KAAL,CAAW,WAAX,EAAwBa,KAAxB,CAA8B,EAAC,WAAU,CAAC,IAAD,EAAMG,UAAU,CAAV,CAAN,CAAX,EAA9B,EAA+Dd,MAA/D,EAAjB;AACA,OAAIgB,WAAS,EAAb;AACA,QAAK,IAAIC,CAAT,IAAcF,MAAd,EAAqB;AACpBC,gBAAUD,OAAOE,CAAP,EAAU/B,MAAV,GAAiB,GAAjB,GAAqB6B,OAAOE,CAAP,EAAUtB,UAA/B,GAA0C,GAA1C,GAA8CoB,OAAOE,CAAP,EAAUR,MAAxD,GAA+D,GAAzE,CADoB,CAC0D;AAC9E;AACD,OAAGO,SAASE,OAAT,CAAiBV,KAAjB,KAAyB,CAAC,CAA7B,EAA+B;AAAG;AACjC,QAAG,MAAKd,GAAL,CAASyB,MAAT,EAAH,EAAqB;AAAG;AACvB,YAAO,MAAKC,IAAL,CAAU;AAChBC,eAAS,KADO;AAEhBC,cAAQ,qBAFQ;AAGhBC,aAAM,IAHU;AAIhBC,YAAKR;AAJW,MAAV,CAAP;AAMA,KAPD,MAOK;AACJ,YAAO,MAAKS,OAAL,CAAa,0BAAb,CAAP;AACA;AACD;AA1Ce;AA4ChB;AA7C8C,CAAhD",
    "file": "..\\..\\..\\src\\admin\\controller\\base.js",
    "sourcesContent": [
        "import commonFun from \"../common_function/common_function.js\";//自定义类 里面有自定义函数\r\nmodule.exports = class extends think.Controller {\r\n\tasync __before() {\r\n\t\tlet userinfo = await this.session('userinfo');\r\n\t\tif(think.isEmpty(userinfo)) {\r\n\t\t\tif(this.ctx.controller != 'login') {\r\n\t\t\t\treturn this.redirect('/admin/login');\r\n\t\t\t}\r\n\t\t}else {\r\n\t\t\tlet menuList = await this.model('menu').order('menu_id ASC, menu_name DESC').select(); //从数据库取出菜单\r\n\t\t\tlet commonFunion = new commonFun(); //需要new一下才能用\r\n\t\t\tlet newMenu = commonFunion.formatMenu(menuList);\r\n\t\t\tconst shuiyanImgThumb = 'imageView2/1/w/320/h/320/interlace/1/q/75|watermark/2/text/5rC056CU5p2R/font/5qW35L2T/fontsize/500/fill/I0Y4RDdCOA==/dissolve/77/gravity/SouthEast/dx/10/dy/10';//七牛的缩略图处理\r\n\t\t\tconst shuiyanImgThumb2 = 'imageView2/1/w/320/h/160/interlace/1/q/75|watermark/2/text/5rC056CU5p2R/font/5qW35L2T/fontsize/500/fill/I0Y4RDdCOA==/dissolve/77/gravity/SouthEast/dx/10/dy/10|imageslim';\r\n\t\t\tthis.assign({\r\n\t\t\t\t'qiniuImgHost':'http://qiniu.iyuge.cn/',\r\n\t\t\t\t'shuiyanImgThumb': shuiyanImgThumb, //缩略图1\r\n\t\t\t\t'shuiyanImgThumb2':shuiyanImgThumb2, //缩略图2\r\n\t\t\t\t'newMenu': newMenu, //赋值菜单\r\n\t\t\t\t'userinfo': userinfo//赋值用户登陆session\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//判断权限\r\n\t\tlet myurl=this.ctx.module+'/'+this.ctx.controller+'/'+this.ctx.action;  // 当前访问的实际模块控制器方法 admin/index/index\r\n\t\tlet role_id=await this.model('admin').where({'admin_id':userinfo.admin_id}).getField('role_id');\r\n\t\tlet auth_rule=await this.model('role').where({'role_id':role_id[0]}).getField('auth_rule');\r\n\t\tlet myAuth=await this.model('authority').where({'auth_id':['IN',auth_rule[0]]}).select();\r\n\t\tlet yunxuUrl='';\r\n\t\tfor (let i in myAuth){\r\n\t\t\tyunxuUrl+=myAuth[i].module+'/'+myAuth[i].controller+'/'+myAuth[i].action+','; //用，拼接成字符串\r\n\t\t}\r\n\t\tif(yunxuUrl.indexOf(myurl)==-1){  //没有权限\r\n\t\t\tif(this.ctx.isAjax()){  //判断是否为ajax请求\r\n\t\t\t\treturn this.json({\r\n\t\t\t\t\tsuccess: false,\r\n\t\t\t\t\terrmsg: '抱歉，您没有权限,请与系统管理员联系!',\r\n\t\t\t\t\terrno:1000,\r\n\t\t\t\t\tdata:yunxuUrl\r\n\t\t\t\t});\r\n\t\t\t}else{\r\n\t\t\t\treturn this.display(\"admin/error_nopermission\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n};\r\n"
    ]
}