{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\slideshow.js"
    ],
    "names": [
        "pagination",
        "require",
        "fs",
        "path",
        "helper",
        "Base",
        "Jimp",
        "qiniu",
        "module",
        "exports",
        "constructor",
        "args",
        "modelInstance",
        "model",
        "indexAction",
        "pageIndex",
        "get",
        "data",
        "slideList",
        "page_data",
        "ctx",
        "desc",
        "pageNum",
        "url",
        "class",
        "text",
        "next",
        "prev",
        "total",
        "assign",
        "display",
        "addAction",
        "slideId",
        "slideData",
        "where",
        "find",
        "uploadImgAction",
        "file",
        "type",
        "filepath",
        "nameArr",
        "name",
        "split",
        "basename",
        "length",
        "YYYYMMDD",
        "datetime",
        "Date",
        "now",
        "staticPath",
        "resolve",
        "think",
        "ROOT_PATH",
        "uploadSlidePath",
        "uploadPath",
        "relativePath",
        "existsSync",
        "mkdirSync",
        "renameSync",
        "datuPath",
        "read",
        "then",
        "lenna",
        "cover",
        "quality",
        "autocrop",
        "write",
        "catch",
        "err",
        "console",
        "error",
        "json",
        "success",
        "errmsg",
        "img_path",
        "img_path_thumb",
        "title",
        "original",
        "uploadQiniuAction",
        "that",
        "localFile",
        "result",
        "uploadFile",
        "addslideAction",
        "isGet",
        "param",
        "editId",
        "descrition",
        "jumpUrl",
        "is_slide",
        "isslide",
        "reg",
        "fail",
        "test",
        "slide_title",
        "slide_img",
        "slide_text",
        "slide_jumpurl",
        "slide_thumb",
        "field",
        "filePath",
        "unlinkSync",
        "editSlide",
        "isSlide",
        "count",
        "addSlide",
        "deleteAction",
        "i",
        "hasOwnProperty",
        "dataId",
        "delete",
        "setslideAction",
        "id",
        "thisRecord",
        "update",
        "key",
        "accessKey",
        "secretKey",
        "mac",
        "auth",
        "digest",
        "Mac",
        "options",
        "scope",
        "putPolicy",
        "rs",
        "PutPolicy",
        "uploadToken",
        "config",
        "conf",
        "Config",
        "zone",
        "Zone_z0",
        "formUploader",
        "form_up",
        "FormUploader",
        "putExtra",
        "PutExtra",
        "returnInfo",
        "Promise",
        "putFile",
        "respErr",
        "respBody",
        "respInfo",
        "msg",
        "statusCode",
        "log"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\slideshow.js",
    "sourcesContent": [
        "const pagination = require('think-pagination');\nconst fs = require('fs');\nconst path = require('path');\nconst helper = require('think-helper');\nconst Base = require('./base.js');\nconst Jimp = require(\"jimp\");\nconst qiniu=require('qiniu');\n\nmodule.exports = class extends Base {\n    /*\n     * 构造函数 便于使用model文件\n     * */\n    constructor(...args) {\n        super(...args);//调用父级的 constructor 方法\n        this.modelInstance = this.model('slideshow'); //增加一个方法\n    }\n  /*图片列表*/\n  async indexAction() {\n      //分页查询列表\n      let pageIndex=this.get('page');\n      const data = await this.modelInstance.slideList(pageIndex);   ////  两个表的字段重复了\n      const page_data = pagination(data, this.ctx, {\n          desc: false, //show description\n          pageNum: 2,\n          url: '', //page url, when not set, it will auto generated\n          class: '', //pagenation extra class\n          text: {\n              next: '下一页',\n              prev: '上一页',\n              total: 'count: __COUNT__ , pages: __PAGE__'\n          }\n      });\n      this.assign({'pagination':page_data,'slide_list':data.data});\n      return this.display();\n  }\n  /*\n  * 增加图片\n  * */\n    async addAction(){\n        let slideId=this.get('slide-id');\n        if(slideId){//有文章id 则是编辑页面 从news表根据id查询数据\n            let slideData=await this.modelInstance.where({'slide_id':slideId}).find();\n            this.assign('slideData',slideData);\n        }\n\n        return this.display();\n    }\n    /*\n    * 单图异步上传\n    * */\n    async uploadImgAction(){\n        let file=this.ctx.file('file');//获取文件\n\n        if(file && file.type === 'image/png' || file.type === 'image/jpeg') {\n            const filepath = file.path;\n            const nameArr = file.name.split('.');\n            const basename = path.basename(filepath) + '.' + nameArr[nameArr.length - 1];\n            const YYYYMMDD = helper.datetime(Date.now(), 'YYYYMMDD');\n            const staticPath = path.resolve(think.ROOT_PATH, 'www/static');\n            const uploadSlidePath=path.resolve(staticPath, 'upload');\n            const uploadPath = path.resolve(uploadSlidePath, 'slideshow');\n            const relativePath = path.resolve(uploadPath, YYYYMMDD);\n\n            // 文件夹不存在则创建\n            if (!fs.existsSync(uploadSlidePath)) {\n                fs.mkdirSync(uploadSlidePath);\n            }\n            if (!fs.existsSync(uploadPath)) {\n                fs.mkdirSync(uploadPath);\n            }\n\n            if (!fs.existsSync(relativePath)) {\n                fs.mkdirSync(relativePath);\n            }\n\n            fs.renameSync(filepath, path.resolve(relativePath, `${basename}`));\n\n            let datuPath=`${think.ROOT_PATH}/www/static/upload/slideshow/${YYYYMMDD}/${basename}`;\n\n            if(datuPath){\n\t            //处理缩略图\n\t            Jimp.read(datuPath).then(function (lenna) {\n\t\t            lenna.cover(320,320)     // resize\n\t\t            .quality(60)         // set JPEG quality\n\t\t            .autocrop()\n\t\t            .write(`${think.ROOT_PATH}/www/static/upload/slideshow/${YYYYMMDD}/${path.basename(filepath)}_thumb.${nameArr[nameArr.length - 1]}`); // save\n\t            }).catch(function (err) {\n\t\t            console.error(err);\n\t            });\n            }\n\n            this.json({\n                success:true,\n                errmsg:'上传成功',\n                data:{\n                    img_path:`/static/upload/slideshow/${YYYYMMDD}/${basename}`,\n                    img_path_thumb:`/static/upload/slideshow/${YYYYMMDD}/${path.basename(filepath)}_thumb.${nameArr[nameArr.length - 1]}`,\n                    title: basename,\n                    original: file.name\n                }\n            });\n\n        }else{\n            this.json({\n                success:true,\n                errmsg:'上传失败',\n                data:[]\n            });\n        }\n\n    }\n    /*\n    * 上传图片到七牛服务器\n    * */\n    async uploadQiniuAction(){\n\t    //this.ctx.respond = false;\n\t    let that=this;\n\n\t    let file=this.ctx.file('file');//获取文件\n\t    if(file && file.type === 'image/png' || file.type === 'image/jpeg'){\n\t\t    let localFile = file.path;\n\t\t    const nameArr = file.name.split('.');\n\n\t\t    const YYYYMMDD = helper.datetime(Date.now(), 'YYYYMMDD');\n\t\t    const basename = 'slide_'+YYYYMMDD+'_'+path.basename(localFile) + '.' + nameArr[nameArr.length - 1];\n\n\t\t    // key=basename;  //存储在七牛的新名称\n\n\n\t\t    // 文件上传\n\n\t\t    let result=await uploadFile(localFile,basename);\n\n\t\t    this.json({\n\t\t\t    success:true,\n\t\t\t    errmsg:'上传成功',\n\t\t\t    data:result.data\n\t\t    });\n\n\t    }else {\n\t\t    this.json({\n\t\t     success:true,\n\t\t     errmsg:'上传失败',\n\t\t     data:[]\n\t\t     });\n\t    }\n\t    /*return that.json({\n\t\t    success:true,\n\t\t    errmsg:'',\n\t\t    data:'jsjsj'\n\t    });*/\n\n    }\n\n    /*\n    * 文字和图片路径提交 存储\n    * */\n    async addslideAction(){\n        const isGet = this.ctx.isGet;\n        const param = this.ctx.param();\n\n        if(isGet){\n            let editId=param.editId;\n            let title=param.title;\n            let descrition=param.descrition;\n            let jumpUrl=param.jumpUrl;\n            let img_path=param.img_path;\n            let img_path_thumb=param.img_path_thumb;\n            let is_slide=param.isslide;\n\t        var reg=/^([hH][tT]{2}[pP]:\\/\\/|[hH][tT]{2}[pP][sS]:\\/\\/)(([A-Za-z0-9-~]+)\\.)+([A-Za-z0-9-~\\/])+$/;\n            if(!title || title==''){\n                this.fail(403,'轮播图标题不能为空');\n                return false;\n            }\n            if(!jumpUrl || jumpUrl==''){\n                this.fail(403,'轮播图跳转链接不能为空');\n                return false;\n            }\n            if(!reg.test(jumpUrl) &&jumpUrl!='#'){\n\t            this.fail(403,'请输入正确的轮播图跳转链接');\n\t            return false;\n            }\n            if(!img_path||img_path==''){\n                this.fail(403,'请先上传图片');\n                return false;\n            }\n            let data={\n                slide_title:title,\n                slide_img:img_path,\n                slide_text:descrition,\n                slide_jumpurl:jumpUrl,\n                slide_thumb:img_path_thumb,\n\t            is_slide:is_slide\n            };\n\n\n            if(editId!=0){//编辑\n                //首先先把本地已经上传的图片删掉 然后再更新数据库数据\n                let slide_img=await this.modelInstance.where({'slide_id':editId}).field('slide_img').find();\n                if(img_path!=slide_img.slide_img){ //如果提交过来的图片路径和数据库的不一致，则是修改了图片\n                    // 检测文件是否存在\n                    let filePath=think.ROOT_PATH+'/www'+slide_img.slide_img;  //图片的路径\n                    if(fs.existsSync(filePath)) { //如果存在则删除图片\n                        fs.unlinkSync(filePath);\n                    }\n                }\n\n                //更新数据\n                let slideId=await this.modelInstance.where({'slide_id':editId}).editSlide(data);\n                let isSlide=await this.modelInstance.where({'is_slide':'1'}).field('is_slide').count(); //设置为轮播图的数量 最多只能设置5\n\t            if(isSlide>=5){\n\t\t            this.fail(403,'轮播图最多只能设置5个，请先取消其他已设置的轮播图');\n\t\t            return false\n\t            }\n\n                if(!slideId){\n                    this.fail(403,'编辑文章失败');\n                }\n                else{\n                    this.success({data:slideId},'编辑文章成功');\n                }\n            }else{//新增\n                let slideId=await this.modelInstance.addSlide(data);\n\t            let isSlide=await this.modelInstance.where({'is_slide':'1'}).field('is_slide').count(); //设置为轮播图的数量 最多只能设置5\n\t            if(isSlide>=5){\n\t\t            this.fail(403,'轮播图最多只能设置5个，请先取消其他已设置的轮播图');\n\t\t            return false\n\t            }\n                if(!slideId){\n                    this.fail(403,'添加轮播图失败');\n                }\n                else{\n                    this.success({data:slideId},'添加轮播图成功');\n                }\n            }\n\n\n        }else{\n            this.fail(403,'请使用get方法');\n        }\n    }\n    /*\n    * 删除图片记录 @同时需要删除对应的已经上传的图片\n    * */\n    async deleteAction(){\n        if(this.isGet){\n            let slideId=this.ctx.param('slide-id');\n            let slide_img=await this.modelInstance.where({'slide_id':slideId}).field('slide_img,slide_thumb').find();\n\n            //循环遍历对象\n\t        if(slide_img){\n\t\t        for (let i in slide_img) {\n\t\t\t        if (slide_img.hasOwnProperty(i) === true) {\n\t\t\t\t        // 检测文件是否存在 删除大图和缩略图\n\t\t\t\t        let filePath=think.ROOT_PATH+'/www'+slide_img[i];  //图片的路径\n\t\t\t\t        if(fs.existsSync(filePath)) { //如果存在则删除图片\n\t\t\t\t\t        fs.unlinkSync(filePath);\n\t\t\t\t        }\n\t\t\t        }\n\t\t        }\n\t        }\n\n            let dataId=await this.modelInstance.where({'slide_id':slideId}).delete();\n            if(!dataId){\n                this.fail(403,'删除轮播图失败');\n            }\n            else{\n                this.success({data:dataId},'删除轮播图成功');\n            }\n        }\n    }\n    /*\n    * 设置为轮播图\n    * */\n    async setslideAction(){\n    \tlet id=this.get('slide-id');\n    \tlet is_slide=this.get('is_slide');\n    \tif(is_slide=='1'){\n\t\t    let isSlide=await this.modelInstance.where({'is_slide':'1'}).field('is_slide').count(); //设置为轮播图的数量 最多只能设置5\n\t\t    if(isSlide>=5){\n\t\t\t    this.fail(403,'轮播图最多只能设置5个，请先取消其他已设置的轮播图');\n\t\t\t    return false;\n\t\t    }\n\t    }\n    \tlet thisRecord=await this.modelInstance.where({'slide_id':id}).update({'is_slide':is_slide});\n\t    if(!thisRecord){\n\t\t    this.fail(403,'更改轮播图状态失败');\n\t    }\n\t    else{\n\t\t    this.success({data:thisRecord},'更改轮播图状态成功');\n\t    }\n    }\n\n};\n\n/*\n* 上传到七牛\n* */\nexport const uploadFile=function (localFile,key) {\n\tconst accessKey = 'If1SWAP60HYq8YUtCWSvgNiL-dvIh_sjVgS3-YPc';\n\tconst secretKey = 'CBcrPNhdn17uTo5fKT3lx-bBgqRI5TFeDs-dizET';\n\tconst mac = new qiniu.auth.digest.Mac(accessKey, secretKey);\n\tlet options = {\n\t\tscope: 'iyuge',  //空间名称\n\t};\n\tlet putPolicy = new qiniu.rs.PutPolicy(options);\n\tlet uploadToken=putPolicy.uploadToken(mac); //创建一个token\n\n\tlet config = new qiniu.conf.Config();\n\t// 空间对应的机房\n\tconfig.zone = qiniu.zone.Zone_z0; //华东\n\t// 是否使用https域名\n\t//config.useHttpsDomain = true;\n\t// 上传是否使用cdn加速\n\t//config.useCdnDomain = true;\n\n\tconst formUploader = new qiniu.form_up.FormUploader(config);\n\tconst putExtra = new qiniu.form_up.PutExtra();\n\n\tlet returnInfo={};\n\treturn new Promise((resolve)=>{\n\t\tformUploader.putFile(uploadToken, key, localFile, putExtra, function(respErr,respBody, respInfo){\n\t\t\tif (respErr) {\n\t\t\t\tresolve(\n\t\t\t\t\treturnInfo={\n\t\t\t\t\t\tmsg:'error',\n\t\t\t\t\t\tdata:[]\n\t\t\t\t\t}\n\n\t\t\t\t);\n\t\t\t\tthrow respErr;\n\t\t\t}\n\t\t\tif (respInfo.statusCode == 200) {\n\t\t\t\tresolve(\n\t\t\t\t\treturnInfo={\n\t\t\t\t\t\tmsg:'success',\n\t\t\t\t\t\tdata:respBody\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t} else {\n\t\t\t\tconsole.log(respInfo.statusCode);\n\t\t\t\tconsole.log(respBody);\n\t\t\t\tresolve(\n\t\t\t\t\treturnInfo={\n\t\t\t\t\t\tmsg:'error',\n\t\t\t\t\t\tdata:respBody\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\n\t\t});\n\n\n\t})\n};\n"
    ]
}