{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\login.js"
    ],
    "names": [
        "module",
        "exports",
        "think",
        "Controller",
        "indexAction",
        "display",
        "captchaAction",
        "options",
        "size",
        "ignoreChars",
        "noise",
        "color",
        "background",
        "width",
        "height",
        "fontSize",
        "charPreset",
        "captcha",
        "ThinkSvgCaptcha",
        "c",
        "create",
        "success",
        "dologinAction",
        "isPost",
        "username",
        "post",
        "password",
        "json",
        "errmsg",
        "data",
        "model",
        "where",
        "admin_name",
        "admin_pass",
        "find",
        "isEmpty",
        "role_status",
        "role_id",
        "field",
        "select",
        "status",
        "session",
        "logoutAction",
        "redirect",
        "changepwAction",
        "user",
        "oldpsw",
        "newpsw",
        "confirmpsw",
        "fail",
        "adminModel",
        "userInfo",
        "userChange",
        "update"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\login.js",
    "sourcesContent": [
        "import ThinkSvgCaptcha from 'think-svg-captcha';\r\n\r\nmodule.exports = class extends think.Controller {\r\n    indexAction() {\r\n        return this.display();\r\n    }\r\n\r\n    /*\r\n     * 验证码\r\n     * */\r\n    captchaAction() {\r\n        const options = {\r\n            size: 4, // size of random string\r\n            ignoreChars: '', // filter out some characters\r\n            noise: 1, // number of noise lines\r\n            color: false, // default grey, true if background option is set\r\n            background: '#ffffff', // background color of the svg image\r\n            width: 80, // width of captcha\r\n            height: 35, // height of captcha\r\n            //fontPath: './fonts/Comismsh.ttf', // your font path\r\n            fontSize: 50, // captcha text size\r\n            charPreset: '0123456789' // random character preset\r\n        };\r\n        let captcha = new ThinkSvgCaptcha(options);\r\n        let c = captcha.create(); // returns an object that has the following property: {data: 'svg path data', text: 'captcha text'}\r\n        this.success({captcha: c}, '获取验证码成功');\r\n    }\r\n\r\n    /*\r\n     * 登陆\r\n     * */\r\n    async dologinAction() {\r\n        if (this.isPost) {\r\n            let username = this.post('username'); //获取用户名\r\n            let password = this.post('password'); //获取密码\r\n\r\n\t        if(!username ||!password){\r\n\t\t        this.json({\r\n\t\t\t        success:false,\r\n\t\t\t        errmsg:'请输入用户名、密码',\r\n\t\t\t        data:[]\r\n\t\t        });\r\n\t\t        return false;\r\n\t        }\r\n\r\n            let data = await this.model('admin').where({admin_name: username, admin_pass: password}).find(); //查询数据库\r\n\t        if (think.isEmpty(data)){\r\n\t\t        this.json({\r\n\t\t\t        success:false,\r\n\t\t\t        errmsg:'账号密码错误！请重新填写',\r\n\t\t\t        data:[]\r\n\t\t        });\r\n\t\t        return false;\r\n\t        }\r\n\t        //判断是否被禁用\r\n\t        let role_status=await this.model('role').where({'role_id':data.role_id}).field('status').select();\r\n\t        if(role_status[0].status==1){\r\n\t\t        this.json({\r\n\t\t\t        success:false,\r\n\t\t\t        errmsg:'此用户已被禁用，请联系管理员',\r\n\t\t\t        data:[]\r\n\t\t        });\r\n\t\t        return false;\r\n\t        }else {\r\n\t\t        this.session('userinfo', data);//存储session\r\n\t\t        return this.json({\r\n\t\t\t        success:true,\r\n\t\t\t        errmsg:'登陆成功',\r\n\t\t\t        data:{username: username}\r\n\t\t        });\r\n\r\n\t        }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * 注销\r\n     */\r\n    async logoutAction() {\r\n        await this.session(null);\r\n        this.redirect('/index');//注销成功清空session，返回到user首页。\r\n    }\r\n    /*\r\n    * 修改密码\r\n    * */\r\n    async changepwAction(){\r\n        if(this.isPost){\r\n            let user=this.post('user');\r\n            let oldpsw=this.post('old_psw');\r\n            let newpsw=this.post('new_psw');\r\n            let confirmpsw=this.post('confirm_psw');\r\n            if(!oldpsw){\r\n                this.fail(403,'请填写原密码');\r\n                return false;\r\n            }\r\n            if(!newpsw){\r\n                this.fail(403,'请填写新密码');\r\n                return false;\r\n            }\r\n            if(newpsw!=confirmpsw){\r\n                this.fail(403,'两次密码不相等');\r\n                return false;\r\n            }\r\n            let adminModel=this.model('admin');\r\n            let userInfo=await adminModel.where({admin_name:user}).find();\r\n            if(oldpsw!=userInfo.admin_pass){\r\n                this.fail(403,'原密码不正确');\r\n                return false;\r\n            }\r\n\r\n            let userChange=await adminModel.where({admin_name:user}).update({admin_pass: confirmpsw});\r\n            await this.session(null);\r\n\r\n            //this.redirect('/index');\r\n            this.success({data:userChange},'修改密码成功');\r\n        }else{\r\n            this.fail(403,'请使用post提交');\r\n        }\r\n\r\n    }\r\n};\r\n"
    ]
}