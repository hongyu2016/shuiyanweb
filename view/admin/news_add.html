{% extends "./base.html" %}
{% block main %}
    <script src="/static/js/ueditor/ueditor.config.js"></script>
    <script src="/static/js/ueditor/ueditor.all.min.js"></script>
    <script src="/static/js/ueditor/lang/zh-cn/zh-cn.js"></script>
    <form action="" method="get" class="form-horizontal" name="upfile">
        <div class="box-body">
            <div class="form-group">
                <label for="sort" class="col-md-1 col-sm-2 control-label"><i class="star">*</i>文章分类</label>
                <div class="col-lg-4 col-md-6 col-sm-10">
                    <select class="form-control" id="sort">
                        {% for list in sortList %}
                        <option data-id="{{list.sort_id}}" >{{list.sort_name}}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="title" class="col-md-1 col-sm-2 control-label"><i class="star">*</i>文章标题</label>
                <div class="col-lg-4 col-md-6 col-sm-10">
                    <input type="text" class="form-control" id="title" placeholder="文章标题" value="{{newsData.title}}">
                </div>
            </div>
            <div class="form-group">
                <label for="sub-title" class="col-md-1 col-sm-2 control-label">副标题</label>
                <div class="col-lg-4 col-md-6 col-sm-10">
                    <input type="text" class="form-control" id="sub-title" placeholder="副标题" value="{{newsData.sub_title}}">
                </div>
            </div>
            <div class="form-group">
                <label for="intro" class="col-md-1 col-sm-2 control-label">简介</label>
                <div class="col-lg-4 col-md-6 col-sm-10">
                    <textarea class="form-control" id="intro" rows="5" placeholder="文章简介">{{newsData.intro}}</textarea>
                </div>
            </div>
            <div class="form-group">
                <label for="author" class="col-md-1 col-sm-2 control-label">作者</label>
                <div class="col-lg-4 col-md-6 col-sm-10">
                    <input type="text" class="form-control" id="author" placeholder="作者" value="{{newsData.author}}">
                </div>
            </div>
            <div class="form-group">
                <label for="copyfrom" class="col-md-1 col-sm-2 control-label">文章来源</label>
                <div class="col-lg-4 col-md-6 col-sm-10">
                    <input type="text" class="form-control" id="copyfrom" placeholder="文章来源" value="{{newsData.copyfrom}}">
                </div>
            </div>
            <div class="form-group">
                <label for="editor" class="col-md-1 col-sm-2 control-label">文章内容</label>
                <div class="col-lg-10 col-md-10 col-sm-10">
                    <script id="editor" type="text/plain" style="width:100%;min-height:300px;"></script>
                </div>
            </div>
        </div>
        <div class="box-footer">
            <div class="col-md-offset-1 col-sm-offset-2">
                {% if newsData %}
                <button type="button" class="btn btn-default" onclick="javascript:window.history.back();">返回</button>
                {% endif %}
                <button type="submit" class="btn btn-success" id="push-btn" style="margin-left: 20px;">确定</button>
            </div>
        </div>
        <div id="edit-content" style="display: none;"></div>

    </form>
    <script>
        $(function () {
            /*
            * 初始化百度编辑器
            * */
            var ue = UE.getEditor('editor');
            $('#push-btn').click(function (e) {
                var editId=GetQueryString('news-id');//是否是编辑
                if(editId){
                    editId=1
                }else{
                    editId=0
                }
                e.preventDefault();
                var sort=$('#sort').find('option:selected').attr('data-id');  //分类
                var title=$('#title').val();//标题
                var subTitle=$('#sub-title').val();
                var intro=$('#intro').text();
                var author=$('#author').val();
                var copyfrom=$('#copyfrom').val();
                var content=UE.getEditor('editor').getContent();
                if(!sort||sort==''){
                    layer.msg('请先建立文章分类');
                    return false;
                }
                if(!title||title==''){
                    layer.msg('请填写文章标题和内容');
                    return false;
                }
                if(!content||content==''){
                    layer.msg('请填写文章内容');
                    return false;
                }

                var postData={
                    sort:sort,
                    title:title,
                    subTitle:subTitle,
                    intro:intro,
                    author:author,
                    content:content,
                    copyfrom:copyfrom,
                    editId:editId
                };
                $.post('/news/doadd',postData,function (data) {
                    if(data.errno==0){
                        layer.msg(data.errmsg);
                    }else{
                        layer.msg(data.errmsg);
                    }
                },'json');

            });
            //编辑时 设置所属栏目选中
            var news_sortId ='{{newsData.sort_id}}';

            $('#edit-content').html('{{newsData.content}}');//把数据库的内容先写入隐藏div
            if(news_sortId){
                $('#sort').find('option[data-id = '+news_sortId+']').attr("selected","selected");
                ue.ready(function() {
                    ue.execCommand( 'inserthtml', $('#edit-content').text()); //取出div的内容 进行html转义插入
                });
            }
        })
    </script>

{% endblock%}